<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:md="clr-namespace:Markdown.Avalonia;assembly=Markdown.Avalonia"
             xmlns:models="using:EasyExtractCrossPlatform.Models"
             xmlns:viewModels="using:EasyExtractCrossPlatform.ViewModels"
             x:Class="EasyExtractCrossPlatform.ReleaseNotesView"
             x:DataType="viewModels:ReleaseNotesViewModel"
             Background="{DynamicResource EasyWindowBackgroundBrush}"
             Padding="32"
             mc:Ignorable="d">
    <UserControl.Styles>
        <Style Selector="Border.card">
            <Setter Property="Background" Value="{DynamicResource EasyGlassGradientBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource EasyGlassBorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="24" />
            <Setter Property="Padding" Value="28" />
            <Setter Property="BoxShadow" Value="0 28 56 0 #12000000" />
        </Style>

        <Style Selector="Border.card.hero-card">
            <Setter Property="CornerRadius" Value="28" />
            <Setter Property="Padding" Value="32" />
        </Style>

        <Style Selector="Border.card.content-card">
            <Setter Property="Padding" Value="28" />
        </Style>

        <Style Selector="Border.chip">
            <Setter Property="Background" Value="{DynamicResource EasyGlassOverlayBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource EasyGlassNeutralBorderBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="Padding" Value="10,4" />
            <Setter Property="Margin" Value="0,0,10,0" />
        </Style>

        <Style Selector="Border.chip.accent">
            <Setter Property="Background" Value="{DynamicResource EasyAccentSoftBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource EasyAccentBrush}" />
        </Style>

        <Style Selector="TextBlock.meta">
            <Setter Property="FontSize" Value="12" />
            <Setter Property="Foreground" Value="{DynamicResource EasyMutedBrush}" />
            <Setter Property="FontWeight" Value="SemiBold" />
        </Style>

        <Style Selector="Button.small">
            <Setter Property="MinHeight" Value="36" />
            <Setter Property="Padding" Value="16,10" />
        </Style>

        <Style Selector="Button.ghost.small">
            <Setter Property="Padding" Value="14,8" />
        </Style>
    </UserControl.Styles>

    <UserControl.Resources>
        <DataTemplate x:Key="ReleaseAssetTemplate" x:DataType="models:GitReleaseAsset">
            <Button Classes="ghost small"
                    Padding="14,8"
                    Margin="0,8,0,0"
                    HorizontalAlignment="Left"
                    Click="OpenReleaseLinkButton_OnClick"
                    CommandParameter="{Binding BrowserDownloadUrl}">
                <StackPanel Orientation="Horizontal"
                            Spacing="10"
                            HorizontalAlignment="Left">
                    <TextBlock Text="Download"
                               FontWeight="SemiBold" />
                    <TextBlock Text="{Binding Name}"
                               FontWeight="SemiBold" />
                    <TextBlock Text="{Binding SizeLabel, StringFormat='({0})'}"
                               Classes="meta" />
                </StackPanel>
            </Button>
        </DataTemplate>

        <DataTemplate x:Key="FeaturedReleaseTemplate" x:DataType="models:GitReleaseInfo">
            <StackPanel Spacing="18">
                <StackPanel Orientation="Horizontal"
                            Spacing="12">
                    <Border Classes="chip accent">
                        <TextBlock Text="{Binding TagName}"
                                   FontSize="12"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource EasyAccentBrush}" />
                    </Border>
                    <Border Classes="chip"
                            IsVisible="{Binding IsPrerelease}">
                        <TextBlock Text="Pre-release"
                                   FontSize="12"
                                   FontWeight="SemiBold" />
                    </Border>
                    <Border Classes="chip"
                            IsVisible="{Binding IsDraft}">
                        <TextBlock Text="Draft"
                                   FontSize="12"
                                   FontWeight="SemiBold" />
                    </Border>
                </StackPanel>

                <StackPanel Spacing="4">
                    <TextBlock Text="{Binding DisplayName}"
                               FontSize="26"
                               FontWeight="Bold"
                               TextWrapping="Wrap" />
                    <TextBlock Classes="meta">
                        <Run Text="{Binding Author}" />
                        <Run Text=" - " />
                        <Run Text="{Binding PublishedLabel}" />
                    </TextBlock>
                </StackPanel>

                <TextBlock Text="{Binding Summary}"
                           FontStyle="Italic"
                           FontSize="14"
                           TextWrapping="Wrap"
                           Foreground="{DynamicResource EasyMutedBrush}"
                           IsVisible="{Binding HasSummary}" />

                <Border Background="{DynamicResource EasyGlassOverlayBrush}"
                        BorderBrush="{DynamicResource EasyGlassNeutralBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="18"
                        Padding="20"
                        Margin="0,10,0,0"
                        IsVisible="{Binding HasBodyMarkdown}">
                    <ScrollViewer MaxHeight="340"
                                  VerticalScrollBarVisibility="Auto">
                        <md:MarkdownScrollViewer Markdown="{Binding BodyWithoutSummaryMarkdown}"
                                                 Margin="0" />
                    </ScrollViewer>
                </Border>

                <StackPanel Spacing="10">
                    <Button Content="View on GitHub"
                            Classes="small"
                            HorizontalAlignment="Left"
                            CommandParameter="{Binding HtmlUrl}"
                            Click="OpenReleaseLinkButton_OnClick" />

                    <ItemsControl ItemsSource="{Binding Assets}"
                                  ItemTemplate="{StaticResource ReleaseAssetTemplate}"
                                  Margin="0,4,0,0"
                                  IsVisible="{Binding HasAssets}" />
                </StackPanel>

            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="AdditionalReleaseTemplate" x:DataType="models:GitReleaseInfo">
            <Border Classes="card"
                    Margin="0,0,0,18">
                <StackPanel Spacing="18">
                    <StackPanel Spacing="6">
                        <TextBlock Text="{Binding DisplayName}"
                                   FontSize="20"
                                   FontWeight="SemiBold"
                                   TextWrapping="Wrap" />
                        <StackPanel Orientation="Horizontal"
                                    Spacing="10"
                                    VerticalAlignment="Center">
                            <Border Classes="chip"
                                    IsVisible="{Binding IsPrerelease}">
                                <TextBlock Text="Pre-release"
                                           FontSize="11"
                                           FontWeight="SemiBold" />
                            </Border>
                            <Border Classes="chip"
                                    IsVisible="{Binding IsDraft}">
                                <TextBlock Text="Draft"
                                           FontSize="11"
                                           FontWeight="SemiBold" />
                            </Border>
                            <TextBlock Text="{Binding PublishedLabel}"
                                       Classes="meta"
                                       Margin="12,0,0,0"
                                       VerticalAlignment="Center" />
                        </StackPanel>
                    </StackPanel>

                    <TextBlock Text="{Binding Summary}"
                               FontStyle="Italic"
                               FontSize="13"
                               Foreground="{DynamicResource EasyMutedBrush}"
                               TextWrapping="Wrap"
                               Margin="0,4,0,0"
                               IsVisible="{Binding HasSummary}" />

                    <Border Background="{DynamicResource EasyGlassOverlayBrush}"
                            BorderBrush="{DynamicResource EasyGlassNeutralBorderBrush}"
                            BorderThickness="1"
                            CornerRadius="14"
                            Padding="18"
                            Margin="0,6,0,0"
                            IsVisible="{Binding HasBodyMarkdown}">
                        <ScrollViewer MaxHeight="320"
                                      VerticalScrollBarVisibility="Auto">
                            <md:MarkdownScrollViewer Markdown="{Binding BodyWithoutSummaryMarkdown}"
                                                     Margin="0" />
                        </ScrollViewer>
                    </Border>

                    <StackPanel Spacing="10">
                        <Button Content="View Release"
                                Classes="small"
                                CommandParameter="{Binding HtmlUrl}"
                                Click="OpenReleaseLinkButton_OnClick" />
                        <ItemsControl ItemsSource="{Binding Assets}"
                                      ItemTemplate="{StaticResource ReleaseAssetTemplate}"
                                      Margin="0,4,0,0"
                                      IsVisible="{Binding HasAssets}" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </DataTemplate>
    </UserControl.Resources>

    <Grid RowDefinitions="Auto,Auto,*"
          MaxWidth="760"
          HorizontalAlignment="Center">
        <Border Grid.Row="0"
                Classes="card hero-card">
            <Grid RowDefinitions="Auto,Auto,*">
                <Grid ColumnDefinitions="*,Auto"
                      VerticalAlignment="Center">
                    <StackPanel Spacing="6">
                        <TextBlock Text="GitHub Releases"
                                   FontSize="20"
                                   FontWeight="SemiBold" />
                        <TextBlock Text="Latest release data pulled directly from GitHub."
                                   Classes="subtle"
                                   FontSize="13" />
                    </StackPanel>

                    <WrapPanel Grid.Column="1"
                               HorizontalAlignment="Right"
                               VerticalAlignment="Center">
                        <TextBlock Text="{Binding LastUpdated, StringFormat='Last updated {0:G}'}"
                                   Classes="meta"
                                   Margin="0,0,12,6"
                                   IsVisible="{Binding HasLastUpdated}" />
                        <ProgressBar Width="140"
                                     Height="4"
                                     Margin="0,0,12,6"
                                     IsIndeterminate="True"
                                     IsVisible="{Binding IsLoading}" />
                        <Button Content="Refresh"
                                Classes="small"
                                Margin="0,0,12,6"
                                Click="RefreshButton_OnClick"
                                ToolTip.Tip="Fetch the newest releases" />
                        <Button Content="Close"
                                Classes="ghost small"
                                Margin="0,0,0,6"
                                Click="CloseButton_OnClick" />
                    </WrapPanel>
                </Grid>

                <Separator Grid.Row="1"
                           Margin="0,24,0,24" />

                <ContentControl Grid.Row="2"
                                Content="{Binding FeaturedRelease}"
                                ContentTemplate="{StaticResource FeaturedReleaseTemplate}"
                                IsVisible="{Binding HasFeaturedRelease}" />

                <Border Grid.Row="2"
                        Background="{DynamicResource EasyGlassOverlayBrush}"
                        BorderBrush="{DynamicResource EasyGlassNeutralBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="18"
                        Padding="28"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Width="320"
                        IsVisible="{Binding ShowEmptyState}">
                    <StackPanel Spacing="12"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center">
                        <TextBlock Text="No releases to display yet"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   HorizontalAlignment="Center" />
                        <TextBlock Text="We will show release notes here once the latest GitHub releases are fetched."
                                   Classes="subtle"
                                   FontSize="13"
                                   TextAlignment="Center" />
                        <Button Content="Refresh now"
                                Classes="ghost small"
                                Click="RefreshButton_OnClick"
                                HorizontalAlignment="Center" />
                    </StackPanel>
                </Border>

                <Border Grid.Row="2"
                        Background="{DynamicResource EasyDangerOverlayBrush}"
                        Margin="0"
                        BorderBrush="{DynamicResource EasyDangerBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="14"
                        Padding="20"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Top"
                        IsVisible="{Binding HasError}">
                    <StackPanel Orientation="Horizontal"
                                Spacing="12">
                        <Border Width="28"
                                Height="28"
                                Background="{DynamicResource EasyDangerBorderBrush}"
                                CornerRadius="10"
                                Opacity="0.85">
                            <TextBlock Text="!"
                                       FontSize="16"
                                       FontWeight="Bold"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center"
                                       Foreground="{DynamicResource EasyWindowBackgroundBrush}" />
                        </Border>
                        <TextBlock Text="{Binding ErrorMessage}"
                                   Foreground="{DynamicResource EasyDangerForegroundBrush}"
                                   FontWeight="SemiBold"
                                   TextWrapping="Wrap" />
                    </StackPanel>
                </Border>
            </Grid>
        </Border>

        <Border Grid.Row="1"
                Classes="card content-card"
                Margin="0,28,0,0"
                IsVisible="{Binding HasAdditionalReleases}">
            <StackPanel Spacing="12">
                <TextBlock Text="Previous releases"
                           FontSize="18"
                           FontWeight="SemiBold" />
                <TextBlock Text="Browse older releases and open them on GitHub."
                           Classes="subtle"
                           FontSize="13" />
            </StackPanel>
        </Border>

        <ScrollViewer Grid.Row="2"
                      Margin="0,12,0,0"
                      HorizontalScrollBarVisibility="Disabled"
                      VerticalScrollBarVisibility="Auto"
                      IsVisible="{Binding HasAdditionalReleases}">
            <ItemsControl ItemsSource="{Binding AdditionalReleases}"
                          ItemTemplate="{StaticResource AdditionalReleaseTemplate}"
                          Margin="0,0,8,0" />
        </ScrollViewer>
    </Grid>
</UserControl>